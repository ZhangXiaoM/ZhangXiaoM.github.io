---
title: 并发编程
date: 2018-06-12 16:49:31
tags: 操作系统
---

## 一、进程

在计算机的世界中，CPU 是唯一的，内存是唯一的，磁盘是唯一的，大部分资源都是共享的，但是正在运行的应用程序不是唯一的，因此，不同的应用程序可能在不同的时刻使用 CPU、内存、磁盘等等，这样就会造成操作系统对硬件和软件的管理混乱。进程概念的引入很好的解决了这个问题，进程是对正在运行的应用程序的抽象，它使所有的应用程序都以为自己在独占的使用 CPU 和内存等等，由于这些抽象的存在，操作系统只需要关心如何正确的调度进程，而不用过多的关心每个进程的细节。

### 1、进程模型

每个进程都由完整的逻辑控制流和虚拟内存构成，逻辑控制流即为正在执行的指令集，虚拟内存同样也是一个抽象概念，他是物理内存和文件的抽象。我们可以拿面向对象的思想看待操作系统相对于进程，对对象来说，我们只需要关心它的部分信息和能力，而不在意它的实现细节。

进程有三种运行状态：阻塞、就绪、运行，三种状态的转换关系为：

![](https://upload-images.jianshu.io/upload_images/5314152-bedc9a2c44438ac7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

### 2、多进程模型

单核 CPU 在同一时刻只能运行一个进程，因此操作系统会通过进程调度程序实现进程的调度，即调整多个进程运行的先后顺序。操作系统会维持一张进程表来保存当前被阻塞的进程的一些信息，目的是为了当此进程重新被调度到运行态时，可以继续接着被阻塞时的状态运行，该进程表包含了所有进程运行的程序计数器、堆栈指针、内存分配状况、打开的文件状态、调度信息等，而每个进程的这些信息被称为该进程的**上下文**。进程表的存在可以使操作系统完美的切换进程，操作系统通过不同的调度方式实现并发编程，如下：

![](https://upload-images.jianshu.io/upload_images/5314152-5608219e35413fa4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

如图 a 和图 b，进程通过这个方式让自己看上去独占的使用程序计数器，如图 c，CPU 通过调度程序实现多进程的并发运行。

### 3、进程调度

上面说了，在计算机的世界，CPU 是稀缺资源，当多个进程同时处于就绪态时就会同时抢占 CPU，因此操作系统需要通过调度算法决定下一个使用 CPU 的进程。调度算法不是唯一的，不同的系统和不同应用场景就会产生不同的调度算法。常见的调度算法大致可归为三类：1）批处理（非抢占），2）交互式（抢占），3）实时。

#### 3.1 批处理

非抢占式，也就是进程运行的先后顺序由调度算法确定，在当前进程运行完之前，不允许其他进程抢占。

- **先来先服务**，顾名思义，按照申请使用 CPU 的先后顺序决定进程使用 CPU 的顺序，调度程序会维护一个队列保存使用 CPU 的进程的顺序，从队头到队尾依次使用，并且直到一个进程运行完它期望的时间，才会运行下一个。当某个进程被阻塞时，它就会被排到队尾等待下一次运行。
- **最短作业优先**，

