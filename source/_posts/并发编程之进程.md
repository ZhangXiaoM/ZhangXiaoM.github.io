---
title: 并发编程之进程
date: 2018-06-12 16:49:31
tags: 操作系统
---

在计算机的世界中，CPU 是唯一的，内存是唯一的，磁盘是唯一的，大部分资源都是共享的，但是正在运行的应用程序不是唯一的，因此，不同的应用程序可能在会在同一时刻使用 CPU、内存、磁盘等等，这样就会造成操作系统对硬件和软件的管理混乱。进程概念的引入很好的解决了这个问题，进程是对正在运行的应用程序的抽象，它使所有的应用程序都以为自己在独占的使用 CPU 和内存，由于这些抽象的存在，操作系统只需要关心如何正确的调度进程，而不用过多的关心每个进程的细节。

### 一、进程模型

每个进程都由完整的逻辑控制流和虚拟内存构成，逻辑控制流即为正在执行的指令集，虚拟内存同样也是一个抽象概念，他是物理内存和文件的抽象。我们可以拿面向对象的思想看待操作系统相对于进程，对对象来说，我们只需要关心它的部分信息和能力，而不在意它的实现细节。

进程有三种运行状态：阻塞、就绪、运行，三种状态的转换关系为：

![](https://upload-images.jianshu.io/upload_images/5314152-bedc9a2c44438ac7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**进程与应用程序**，应用程序是由代码和数据组成的，它可以作为目标模块被存储在磁盘上， 或者作为段被存储在内存中，而进程是运行中的程序的一个特殊实例，进程的上下文中存储着程序运行的状态、寄存器、堆栈等信息。

### 二、多进程模型

对操作系统而言，多个进程并发的运行是其基本能力之一，但是单核 CPU 在同一时刻只能运行一个进程，因此操作系统会通过进程调度程序实现进程的调度，即调整多个进程运行的先后顺序，让它们能*并发的*运行。操作系统会维持一张进程表来保存当前被阻塞的进程的一些信息，目的是为了当此进程重新被调度到运行态时，可以继续接着被阻塞时的状态运行，该进程表包含了所有进程运行的程序计数器、堆栈指针、内存分配状况、打开的文件状态、调度信息等，而每个进程的这些信息被称为该进程的**上下文**。进程表的存在可以使操作系统完美的切换进程，操作系统通过不同的调度方式实现并发编程，如下：

![](https://upload-images.jianshu.io/upload_images/5314152-5608219e35413fa4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

如图 a 和图 b，进程通过这个方式让自己看上去独占的使用程序计数器，如图 c，CPU 通过调度程序实现多进程的*并发*运行。

### 三、进程调度

上面说了，在计算机的世界，CPU 是稀缺资源，当多个进程同时处于就绪态时就会同时抢占 CPU，因此操作系统需要通过调度算法决定下一个使用 CPU 的进程。调度算法不是唯一的，不同的系统和不同应用场景就会产生不同的调度算法。常见的调度算法大致可归为三类：1）批处理（非抢占），2）交互式（抢占），3）实时。

#### 3.1 批处理（非抢占）

非抢占式，也就是进程运行的先后顺序由调度算法确定，在当前进程运行完之前，不允许其他进程抢占。

- **先来先服务**，顾名思义，按照申请使用 CPU 的先后顺序决定进程使用 CPU 的顺序，调度程序会维护一个队列保存使用 CPU 的进程的顺序，从队头到队尾依次使用，并且直到一个进程运行完它期望的时间，才会运行下一个。当某个进程被阻塞时，它就会被排到队尾等待下一次运行。

- **最短作业优先**，运行时间最短的进程优先使用 CPU，例如运行时间分别为：4，1，3，2 分钟的4个进程 A、B、C、D 同时到达时，4个进程的运行次序为运行时间最短的到运行时间最长的，即 B、D、C、A 依次运行。注意，只有几个进程同时到达时，这个算法才是最优的。

#### 3.2 交互式（抢占） 

抢占式的概念意味着，当前正在运行的进程没运行完其期望的时间时就被其他进程抢占。

- **最短剩余时间优先**，该算法是最短作业优先的抢占式版本，该算法总是优先选择剩余运行时间最短的那个进程运行，调度程序会先从到达的进程中选择最短运行时间的进程运行，在运行过程中新到达进程的运行时间如果短于正在运行的进程的剩余时间，那么正在运行的进程就会被挂起，新到达的进程会被运行。当当前运行进程运行完，调度程序会在剩下所有处于就绪状态的进程中选择最短剩余时间的进程运行。
- **轮转式调度**，轮转式调度是最古老的、最公平的、使用最多的调度算法，它会为每个进程分配一个运行的时间段，称为**时间片**。 调度程序会维护一张待运行的进程列表，当一个进程用完它的时间片之后，就会被移到队尾，等待下一次运行。如果某个进程在时间片结束之前阻塞或者运行完成，调度程序会立刻切换到下一个进程。
- **优先级调度**，轮转式调度默认所有的进程同等重要，而优先级调度则根据每个进程的重要程度分为不同的优先级，优先级高的进程先运行。同等优先级的进程遵循轮转式调度，即同一优先级的进程被放入同一队列中进行轮转调度，只有高优先级的队列为空时，才会运行低优先级队列中的进程。这种调度方法的劣势是低优先级的进程很可能会长期处于*饥饿*状态。

#### 3.3 实时

实时调度是一种受时间主导的调度系统，例如，在某一时间，外部的一种或者多种物理设备给了计算机一个刺激，而计算机必须要在一个确定的时间范围内做出适当的反应。这就要求调度程序马上抢占当前正在运行的进程，并且调度新的进程响应外部刺激，这些进程一般寿命较短，并且很短的时间内就可以运行完成。

### 四、进程间的通信（IPC, Inter Process Communication）

